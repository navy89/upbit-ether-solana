<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>비트코인 퀀트 투자 대시보드</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --bg: #0a0d14;
      --card: #111827;
      --card-soft: #1f2937;
      --line: #334155;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --risk-on: #22c55e;
      --neutral: #f59e0b;
      --risk-off: #ef4444;
      --accent: #38bdf8;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(circle at 20% 0%, #111827, var(--bg));
      color: var(--text);
    }
    .container { max-width: 1320px; margin: 0 auto; padding: 24px; }
    h1 { margin: 0; font-size: 28px; }
    .subtitle { margin-top: 8px; color: var(--muted); line-height: 1.4; }
    .toolbar {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .btn {
      border: 1px solid var(--line);
      color: var(--text);
      background: rgba(56, 189, 248, 0.15);
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
    }
    .btn:hover { background: rgba(56, 189, 248, 0.25); }
    .toolbar-note { font-size: 12px; color: var(--muted); }
    .grid { display: grid; gap: 16px; }
    .top-grid { grid-template-columns: 1.3fr 1fr; margin-top: 18px; }
    .four-grid { grid-template-columns: repeat(4, 1fr); margin-top: 16px; }
    .two-grid { grid-template-columns: 1fr 1fr; margin-top: 16px; }
    .card {
      background: linear-gradient(180deg, rgba(31,41,55,.8), rgba(17,24,39,.95));
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px;
    }
    .card h2 { margin: 0 0 12px; font-size: 15px; color: #cbd5e1; }
    .score-row { display: flex; justify-content: space-between; align-items: baseline; gap: 8px; }
    .score { font-size: 42px; font-weight: 800; letter-spacing: .5px; }
    .state-pill {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 700;
      background: rgba(245, 158, 11, 0.15);
      color: var(--neutral);
      border: 1px solid rgba(245, 158, 11, 0.45);
    }
    .bar-wrap { margin-top: 14px; }
    .bar {
      height: 14px;
      border-radius: 999px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      border: 1px solid var(--line);
    }
    .seg-on { background: rgba(34, 197, 94, .75); }
    .seg-neutral { background: rgba(245, 158, 11, .75); }
    .seg-off { background: rgba(239, 68, 68, .75); }
    .marker {
      position: relative;
      top: -19px;
      width: 0;
      border-left: 7px solid transparent;
      border-right: 7px solid transparent;
      border-top: 11px solid #e2e8f0;
      transform: translateX(-50%);
    }
    .labels { margin-top: 2px; display: flex; justify-content: space-between; color: var(--muted); font-size: 12px; }
    .metric { font-size: 13px; color: var(--muted); margin: 8px 0 0; }
    .mini { color: var(--muted); font-size: 12px; line-height: 1.5; }
    .layer-title { font-size: 13px; font-weight: 700; margin-bottom: 8px; }
    .layer-value { font-size: 28px; font-weight: 700; margin: 8px 0; }
    .risk-on { color: var(--risk-on); }
    .risk-neutral { color: var(--neutral); }
    .risk-off { color: var(--risk-off); }
    .tag {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid var(--line);
      color: #cbd5e1;
      background: rgba(148, 163, 184, 0.1);
    }
    .table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .table th, .table td { padding: 8px; border-bottom: 1px solid var(--line); text-align: left; }
    .table th { color: var(--muted); font-weight: 600; }
    .table tr:last-child td { border-bottom: none; }
    .strategy-list { display: grid; gap: 10px; }
    .strategy-item { padding: 10px; border-radius: 10px; background: rgba(51,65,85,.35); border: 1px solid var(--line); }
    .strategy-item strong { font-size: 13px; }
    .footer-note { margin-top: 16px; color: var(--muted); font-size: 12px; }
    @media (max-width: 1050px) {
      .top-grid, .four-grid, .two-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const scoreToState = (score) => {
      if (score >= 67) return { label: 'Risk-on 우세', className: 'risk-on' };
      if (score <= 33) return { label: 'Risk-off 우세', className: 'risk-off' };
      return { label: '중립/전이 구간', className: 'risk-neutral' };
    };

    const indicatorRows = [
      { name: '로그 수익률 (24h)', value: '+1.86%', layer: '가격·파생', signal: '모멘텀 유지' },
      { name: '실현 변동성 (7d)', value: '48.2%', layer: '가격·파생', signal: '확장 전조' },
      { name: '활성 주소 증감 (7d)', value: '+6.1%', layer: '온체인', signal: '참여자 증가' },
      { name: '펀딩비 평균 (24h)', value: '+0.012%', layer: '파생·포지셔닝', signal: '롱 과열 경계' },
      { name: 'Open Interest 증감', value: '+8.4%', layer: '파생·포지셔닝', signal: '레버리지 유입' },
      { name: 'DXY 주간 변화', value: '-0.42%', layer: '거시·외생', signal: '위험자산 우호' },
    ];

    function App() {
      const regimeScore = 58;
      const state = scoreToState(regimeScore);
      const generatedAt = new Date().toISOString();

      const layers = [
        { title: '가격·파생 지표', score: 62, summary: '단기 추세 우상향 + 변동성 확대 가능성' },
        { title: '온체인 지표', score: 55, summary: '네트워크 활동 회복, 보유 성향은 중립' },
        { title: '파생·포지셔닝', score: 49, summary: '레버리지 유입과 과열 신호가 공존' },
        { title: '거시·외생 변수', score: 66, summary: '달러 약세/유동성 완화로 배경 우호' },
      ];

      const similarRegime = [
        { period: '2023-10 ~ 2023-12', vol: '중간→확대', best: '추세추종 + 분할진입', dd: '-6.8%' },
        { period: '2024-02 ~ 2024-03', vol: '높음', best: '브레이크아웃 + 변동성 타겟팅', dd: '-8.1%' },
        { period: '2024-09 ~ 2024-10', vol: '중간', best: '캐리 + 리밸런싱', dd: '-4.9%' },
      ];

      const downloadBlob = (filename, content, mimeType) => {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.click();
        URL.revokeObjectURL(url);
      };

      const handleDownloadJSON = () => {
        const payload = {
          dashboard: 'bitcoin-quant-regime-dashboard',
          generatedAt,
          regimeScore,
          regimeState: state.label,
          layers,
          indicators: indicatorRows,
          similarRegime,
          notes: 'Conceptual example for regime-based investment decision support.',
        };

        downloadBlob(
          `btc-regime-dashboard-${generatedAt.slice(0, 10)}.json`,
          JSON.stringify(payload, null, 2),
          'application/json;charset=utf-8'
        );
      };

      const handleDownloadCSV = () => {
        const header = ['지표', '값', '계층', '해석'];
        const rows = indicatorRows.map((item) => [item.name, item.value, item.layer, item.signal]);
        const csv = [header, ...rows]
          .map((line) => line.map((value) => `"${String(value).replaceAll('"', '""')}"`).join(','))
          .join('\n');

        downloadBlob(
          `btc-indicators-${generatedAt.slice(0, 10)}.csv`,
          `\uFEFF${csv}`,
          'text/csv;charset=utf-8'
        );
      };

      return (
        <div className="container">
          <h1>비트코인 퀀트 투자 대시보드 (Regime Framework)</h1>
          <p className="subtitle">
            단일 매수/매도 신호가 아니라, 시장 상태(Regime)를 확률적으로 해석하여 전략 선택과 포지션 사이징을 지원하는 통합 분석 대시보드
          </p>
          <div className="toolbar">
            <button className="btn" onClick={handleDownloadJSON}>JSON 다운로드</button>
            <button className="btn" onClick={handleDownloadCSV}>지표 CSV 다운로드</button>
            <span className="toolbar-note">오프라인 분석용으로 현재 화면 데이터를 내려받을 수 있습니다.</span>
          </div>

          <div className="grid top-grid">
            <section className="card">
              <h2>Market Regime Score</h2>
              <div className="score-row">
                <div className="score">{regimeScore}</div>
                <div className="state-pill">{state.label}</div>
              </div>

              <div className="bar-wrap">
                <div className="bar">
                  <div className="seg-off"/>
                  <div className="seg-neutral"/>
                  <div className="seg-on"/>
                </div>
                <div className="marker" style={{ marginLeft: `${regimeScore}%` }} />
                <div className="labels">
                  <span>Risk-off</span><span>Neutral</span><span>Risk-on</span>
                </div>
              </div>
              <p className="metric">
                현재 해석: 위험선호 전환 시도 구간. 다만 파생 포지셔닝 과열 여부를 함께 감시 필요.
              </p>
            </section>

            <section className="card">
              <h2>의사결정 프레임</h2>
              <div className="strategy-list">
                <div className="strategy-item">
                  <strong>Q1. 현재 시장은 어떤 Regime인가?</strong>
                  <div className="mini">중립(33~67) 내 상단으로 이동 중이며, Risk-on 확률이 점진적으로 우세.</div>
                </div>
                <div className="strategy-item">
                  <strong>Q2. 변동성 확장 조건부 확률은?</strong>
                  <div className="mini">Open Interest 급증 + Funding 양(+) 고착 시 단기 급변동 리스크 증가.</div>
                </div>
                <div className="strategy-item">
                  <strong>Q3. 적합 전략은?</strong>
                  <div className="mini">추세추종 비중 확대, 포지션은 변동성 타겟팅으로 단계적 증감.</div>
                </div>
              </div>
            </section>
          </div>

          <div className="grid four-grid">
            {layers.map((layer) => {
              const s = scoreToState(layer.score);
              return (
                <section className="card" key={layer.title}>
                  <div className="layer-title">{layer.title}</div>
                  <span className="tag">Layer Score</span>
                  <div className={`layer-value ${s.className}`}>{layer.score}</div>
                  <div className="mini">{layer.summary}</div>
                </section>
              );
            })}
          </div>

          <div className="grid two-grid">
            <section className="card">
              <h2>원천 지표 스냅샷 (Evidence-based Inputs)</h2>
              <table className="table">
                <thead>
                  <tr>
                    <th>지표</th>
                    <th>값</th>
                    <th>계층</th>
                    <th>해석</th>
                  </tr>
                </thead>
                <tbody>
                  {indicatorRows.map((row) => (
                    <tr key={row.name}>
                      <td>{row.name}</td>
                      <td>{row.value}</td>
                      <td>{row.layer}</td>
                      <td>{row.signal}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </section>

            <section className="card">
              <h2>유사 Regime 성과 레퍼런스</h2>
              <table className="table">
                <thead>
                  <tr>
                    <th>유사 기간</th>
                    <th>변동성</th>
                    <th>상대적 우위 전략</th>
                    <th>최대낙폭</th>
                  </tr>
                </thead>
                <tbody>
                  {similarRegime.map((item) => (
                    <tr key={item.period}>
                      <td>{item.period}</td>
                      <td>{item.vol}</td>
                      <td>{item.best}</td>
                      <td>{item.dd}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </section>
          </div>

          <p className="footer-note">
            본 대시보드는 미래 가격을 단정적으로 예측하지 않으며, Regime 전이 확률과 전략 적합도를 통해 불확실성 하 의사결정을 지원합니다.
          </p>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
