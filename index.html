<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>솔라나-이더리움 가격 추적기</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0a0a0f;
            --bg-card: #13131a;
            --accent-green: #00ff88;
            --accent-red: #ff3366;
            --accent-blue: #00d4ff;
            --accent-yellow: #ffd600;
            --text-primary: #ffffff;
            --text-secondary: #8a8a9f;
            --border: #2a2a35;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .container {
            padding: 1rem;
            max-width: 1600px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 0.75rem;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #9945ff, var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.25rem;
        }

        .subtitle {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            flex: 1;
            overflow: hidden;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .card-title {
            font-size: 0.65rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .coin-grid {
            display: grid;
            gap: 0.5rem;
            flex: 1;
        }

        .coin-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 0.5rem;
            border-radius: 6px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 0.5rem;
            align-items: center;
        }

        .coin-name {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .coin-price {
            font-size: 0.85rem;
            font-weight: 700;
            text-align: right;
            transition: all 0.15s ease;
        }

        .coin-price.flash-up {
            animation: flashUp 0.4s ease;
        }

        .coin-price.flash-down {
            animation: flashDown 0.4s ease;
        }

        @keyframes flashUp {
            0% { color: var(--text-primary); transform: scale(1); }
            50% {
                color: var(--accent-red);
                transform: scale(1.1);
                text-shadow: 0 0 10px var(--accent-red);
            }
            100% { color: var(--text-primary); transform: scale(1); }
        }

        @keyframes flashDown {
            0% { color: var(--text-primary); transform: scale(1); }
            50% {
                color: var(--accent-blue);
                transform: scale(1.1);
                text-shadow: 0 0 10px var(--accent-blue);
            }
            100% { color: var(--text-primary); transform: scale(1); }
        }

        .coin-change {
            font-size: 0.65rem;
            font-weight: 600;
            padding: 0.15rem 0.35rem;
            border-radius: 3px;
            white-space: nowrap;
        }

        .change-positive {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-green);
        }

        .change-negative {
            background: rgba(255, 51, 102, 0.15);
            color: var(--accent-red);
        }

        .difference-card {
            background: linear-gradient(135deg, #1a1a25 0%, #25252f 100%);
            border: 2px solid #9945ff;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .diff-value {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
            transition: all 0.15s ease;
        }

        .diff-value.flash-up {
            animation: flashUp 0.4s ease;
        }

        .diff-value.flash-down {
            animation: flashDown 0.4s ease;
        }

        .diff-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
        }

        .input-card {
            background: linear-gradient(135deg, #1a2520 0%, #252f28 100%);
            border: 2px solid #00ff88;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.5rem;
        }

        .eth-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
            font-family: 'Inter', sans-serif;
            width: 100%;
        }

        .eth-input:focus {
            outline: none;
            border-color: #00ff88;
            background: rgba(255, 255, 255, 0.08);
        }

        .eth-input::placeholder {
            color: var(--text-secondary);
            font-weight: 400;
        }

        .input-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .fee-grid {
            display: grid;
            gap: 0.4rem;
        }

        .fee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
        }

        .fee-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
        }

        .fee-value {
            font-size: 0.75rem;
            font-weight: 700;
        }

        .fee-total {
            background: rgba(255, 214, 0, 0.1);
            border-left: 2px solid var(--accent-yellow);
        }

        .stats-card {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .stat-period {
            font-size: 0.55rem;
            color: #9945ff;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.15rem;
        }

        .stat-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.2rem;
            padding: 0.3rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
        }

        .stat-value {
            font-size: 0.7rem;
            font-weight: 700;
        }

        .stat-time {
            font-size: 0.5rem;
            color: var(--text-secondary);
        }

        .chart-card {
            grid-column: 1 / -1;
            min-height: 0;
        }

        .chart-info {
            display: flex;
            gap: 1.5rem;
            padding: 0.5rem 0;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            border-bottom: 1px solid var(--border);
            min-height: 32px;
            height: 32px;
            align-items: center;
        }

        .chart-info-item {
            display: flex;
            gap: 0.5rem;
        }

        .chart-info-label {
            color: var(--text-secondary);
        }

        .chart-info-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .chart-info-placeholder {
            color: var(--text-secondary);
            font-size: 0.7rem;
        }

        .chart-container {
            position: relative;
            flex: 1;
            min-height: 0;
            touch-action: none;
        }

        .chart-svg {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
        }

        .crosshair-line {
            pointer-events: none;
        }

        .status {
            position: fixed;
            bottom: 0.5rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.75rem;
            align-items: center;
            padding: 0.4rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.6rem;
            color: var(--text-secondary);
            z-index: 1000;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
                height: auto;
                min-height: 100vh;
            }

            h1 {
                font-size: 1.2rem;
            }

            .main-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .card {
                padding: 0.6rem;
            }

            .diff-value {
                font-size: 1.4rem;
            }

            .chart-card {
                margin: 0 -0.5rem;
                width: calc(100% + 1rem);
                border-radius: 0;
            }

            .chart-svg {
                min-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function CandlestickChart({ data, onHover }) {
            const svgRef = useRef(null);
            const containerRef = useRef(null);
            const [isTouching, setIsTouching] = useState(false);
            const [dimensions, setDimensions] = useState({ width: 0, height: 0 });

            // 컨테이너 크기 관찰
            useEffect(() => {
                if (!containerRef.current) return;

                const updateSize = () => {
                    if (containerRef.current) {
                        const rect = containerRef.current.getBoundingClientRect();
                        setDimensions({ width: rect.width, height: rect.height });
                    }
                };

                updateSize();

                const resizeObserver = new ResizeObserver(updateSize);
                resizeObserver.observe(containerRef.current);

                window.addEventListener('resize', updateSize);

                return () => {
                    resizeObserver.disconnect();
                    window.removeEventListener('resize', updateSize);
                };
            }, []);

            useEffect(() => {
                if (!data || data.length === 0 || !svgRef.current || !containerRef.current || dimensions.width === 0) return;

                const container = containerRef.current;
                const svg = svgRef.current;
                const width = dimensions.width;
                const height = Math.max(dimensions.height, 350);

                svg.innerHTML = '';
                svg.setAttribute('width', width);
                svg.setAttribute('height', height);
                svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
                svg.style.display = 'block';

                const isMobile = width < 768;
                const padding = isMobile
                    ? { top: 20, right: 60, bottom: 40, left: 10 }
                    : { top: 20, right: 80, bottom: 40, left: 10 };

                const chartWidth = width - padding.left - padding.right;
                const chartHeight = height - padding.top - padding.bottom;

                const allValues = data.flatMap(d => [d.o, d.c]);
                const minValue = Math.min(...allValues);
                const maxValue = Math.max(...allValues);
                const valueRange = maxValue - minValue;
                const valuePadding = valueRange * 0.1;

                const yScale = (value) => {
                    return padding.top + chartHeight - ((value - (minValue - valuePadding)) / (valueRange + valuePadding * 2)) * chartHeight;
                };

                const candleWidth = Math.max(2, Math.min(12, chartWidth / data.length * 0.7));
                const candleGap = chartWidth / data.length;

                // Y축 그리드 및 레이블
                const gridCount = 6;
                for (let i = 0; i <= gridCount; i++) {
                    const value = (minValue - valuePadding) + ((valueRange + valuePadding * 2) / gridCount) * i;
                    const y = yScale(value);

                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', padding.left);
                    line.setAttribute('y1', y);
                    line.setAttribute('x2', width - padding.right);
                    line.setAttribute('y2', y);
                    line.setAttribute('stroke', 'rgba(255,255,255,0.05)');
                    line.setAttribute('stroke-width', '1');
                    svg.appendChild(line);

                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', width - padding.right + 5);
                    text.setAttribute('y', y + 4);
                    text.setAttribute('fill', '#8a8a9f');
                    text.setAttribute('font-size', '10');
                    text.setAttribute('text-anchor', 'start');
                    text.textContent = Math.round(value).toLocaleString();
                    svg.appendChild(text);
                }

                // X축 날짜 라벨
                const dateMap = new Map();
                data.forEach((candle, i) => {
                    const date = new Date(candle.x);
                    const dateKey = `${date.getMonth()+1}/${date.getDate()}`;

                    if (!dateMap.has(dateKey)) {
                        dateMap.set(dateKey, i);
                    }
                });

                const dateEntries = Array.from(dateMap.entries());
                const dateStep = Math.ceil(dateEntries.length / (isMobile ? 4 : 7));

                dateEntries.forEach(([dateLabel, index], i) => {
                    if (i % dateStep !== 0 && i !== dateEntries.length - 1) return;

                    const x = padding.left + candleGap * index + candleGap / 2;

                    const dateText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    dateText.setAttribute('x', x);
                    dateText.setAttribute('y', height - padding.bottom + 20);
                    dateText.setAttribute('fill', '#8a8a9f');
                    dateText.setAttribute('font-size', '10');
                    dateText.setAttribute('text-anchor', 'middle');
                    dateText.textContent = dateLabel;
                    svg.appendChild(dateText);

                    const dateLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    dateLine.setAttribute('x1', x);
                    dateLine.setAttribute('y1', padding.top);
                    dateLine.setAttribute('x2', x);
                    dateLine.setAttribute('y2', height - padding.bottom);
                    dateLine.setAttribute('stroke', 'rgba(255,255,255,0.03)');
                    dateLine.setAttribute('stroke-width', '1');
                    svg.appendChild(dateLine);
                });

                // 캔들스틱 그리기
                data.forEach((candle, i) => {
                    const x = padding.left + candleGap * i + candleGap / 2;
                    const openY = yScale(candle.o);
                    const closeY = yScale(candle.c);

                    const isPositive = candle.c >= candle.o;
                    const color = isPositive ? '#00ff88' : '#ff3366';

                    const bodyHeight = Math.abs(closeY - openY);
                    const bodyY = Math.min(openY, closeY);

                    const body = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    body.setAttribute('x', x - candleWidth / 2);
                    body.setAttribute('y', bodyY);
                    body.setAttribute('width', candleWidth);
                    body.setAttribute('height', Math.max(bodyHeight, 1));
                    body.setAttribute('fill', color);
                    body.setAttribute('opacity', '0.8');
                    svg.appendChild(body);
                });

                // 크로스헤어 요소
                const crosshairGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                crosshairGroup.setAttribute('class', 'crosshair');
                crosshairGroup.style.display = 'none';
                crosshairGroup.style.pointerEvents = 'none';

                const vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                vLine.setAttribute('class', 'crosshair-line');
                vLine.setAttribute('stroke', '#00d4ff');
                vLine.setAttribute('stroke-width', '1');
                vLine.setAttribute('stroke-dasharray', '4,4');
                vLine.setAttribute('y1', padding.top);
                vLine.setAttribute('y2', height - padding.bottom);
                crosshairGroup.appendChild(vLine);

                const hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                hLine.setAttribute('class', 'crosshair-line');
                hLine.setAttribute('stroke', '#00d4ff');
                hLine.setAttribute('stroke-width', '1');
                hLine.setAttribute('stroke-dasharray', '4,4');
                hLine.setAttribute('x1', padding.left);
                hLine.setAttribute('x2', width - padding.right);
                crosshairGroup.appendChild(hLine);

                svg.appendChild(crosshairGroup);

                // 투명 오버레이
                const overlay = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                overlay.setAttribute('x', padding.left);
                overlay.setAttribute('y', padding.top);
                overlay.setAttribute('width', chartWidth);
                overlay.setAttribute('height', chartHeight);
                overlay.setAttribute('fill', 'transparent');
                overlay.setAttribute('cursor', 'crosshair');

                const updateCrosshair = (clientX) => {
                    const rect = svg.getBoundingClientRect();
                    const x = clientX - rect.left;

                    if (x < padding.left || x > width - padding.right) {
                        crosshairGroup.style.display = 'none';
                        onHover(null);
                        return;
                    }

                    const dataIndex = Math.round((x - padding.left) / candleGap - 0.5);

                    if (dataIndex >= 0 && dataIndex < data.length) {
                        const candle = data[dataIndex];
                        const candleX = padding.left + candleGap * dataIndex + candleGap / 2;
                        const candleY = yScale(candle.c);

                        vLine.setAttribute('x1', candleX);
                        vLine.setAttribute('x2', candleX);
                        hLine.setAttribute('y1', candleY);
                        hLine.setAttribute('y2', candleY);

                        crosshairGroup.style.display = 'block';
                        onHover(candle);
                    }
                };

                const hideCrosshair = () => {
                    crosshairGroup.style.display = 'none';
                    onHover(null);
                };

                overlay.addEventListener('mouseenter', (e) => {
                    if (!isMobile) updateCrosshair(e.clientX);
                });

                overlay.addEventListener('mousemove', (e) => {
                    if (!isMobile) updateCrosshair(e.clientX);
                });

                overlay.addEventListener('mouseleave', () => {
                    if (!isTouching && !isMobile) hideCrosshair();
                });

                overlay.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    setIsTouching(true);
                    const touch = e.touches[0];
                    updateCrosshair(touch.clientX);
                }, { passive: false });

                overlay.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    updateCrosshair(touch.clientX);
                }, { passive: false });

                overlay.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    setTimeout(() => {
                        setIsTouching(false);
                        hideCrosshair();
                    }, 1500);
                }, { passive: false });

                overlay.addEventListener('touchcancel', () => {
                    setIsTouching(false);
                    hideCrosshair();
                });

                svg.appendChild(overlay);

            }, [data, onHover, isTouching, dimensions]);

            return (
                <div ref={containerRef} style={{ width: '100%', height: '100%', minHeight: '350px' }}>
                    <svg ref={svgRef} className="chart-svg" style={{ display: 'block', width: '100%', height: '100%' }}></svg>
                </div>
            );
        }

        function App() {
            const [prices, setPrices] = useState({ eth: null, sol: null, btc: null });
            const [dayChanges, setDayChanges] = useState({ eth: 0, sol: 0, btc: 0 });
            const [stats24h, setStats24h] = useState(null);
            const [stats7d, setStats7d] = useState(null);
            const [chartData, setChartData] = useState([]);
            const [hourlyData, setHourlyData] = useState([]);
            const [hoverData, setHoverData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [flashStates, setFlashStates] = useState({});
            const [customEthAmount, setCustomEthAmount] = useState('');
            const [satoshiStats, setSatoshiStats] = useState({ max: null, min: null });

            const wsRef = useRef(null);
            const prevPricesRef = useRef({});

            const ETH_AMOUNT = 20;
            const SOL_AMOUNT = 400;
            const FEE_RATE = 0.0005;

            const triggerFlash = (field, direction) => {
                setFlashStates(prev => ({ ...prev, [field]: direction }));
                setTimeout(() => {
                    setFlashStates(prev => ({ ...prev, [field]: null }));
                }, 400);
            };

            const fetchHourlyCandles = async () => {
                try {
                    const allCandles = { 'KRW-ETH': [], 'KRW-SOL': [], 'KRW-BTC': [] };

                    for (const market of ['KRW-ETH', 'KRW-SOL', 'KRW-BTC']) {
                        const response = await fetch(`https://api.upbit.com/v1/candles/minutes/60?market=${market}&count=168`);
                        if (response.ok) {
                            const data = await response.json();
                            allCandles[market] = data;
                            await new Promise(r => setTimeout(r, 100));
                        }
                    }

                    const candleData = [];
                    const hourlyTable = [];
                    const minLen = Math.min(allCandles['KRW-ETH'].length, allCandles['KRW-SOL'].length, allCandles['KRW-BTC'].length);

                    for (let i = minLen - 1; i >= 0; i--) {
                        const eth = allCandles['KRW-ETH'][i];
                        const sol = allCandles['KRW-SOL'][i];
                        const btc = allCandles['KRW-BTC'][i];

                        const ethSatoshi = (eth.trade_price / btc.trade_price) * 100000000 * ETH_AMOUNT;
                        const solSatoshi = (sol.trade_price / btc.trade_price) * 100000000 * SOL_AMOUNT;
                        const diff = ethSatoshi - solSatoshi;

                        const ethOpenSatoshi = (eth.opening_price / btc.opening_price) * 100000000 * ETH_AMOUNT;
                        const solOpenSatoshi = (sol.opening_price / btc.opening_price) * 100000000 * SOL_AMOUNT;
                        const openDiff = ethOpenSatoshi - solOpenSatoshi;

                        const timestamp = new Date(eth.candle_date_time_kst).getTime();

                        candleData.push({
                            x: timestamp,
                            o: openDiff,
                            c: diff
                        });

                        // 24시간 이내 데이터만 테이블에 추가
                        if (Date.now() - timestamp < 24 * 60 * 60 * 1000) {
                            hourlyTable.push({
                                timestamp,
                                diff
                            });
                        }
                    }

                    setChartData(candleData);
                    setHourlyData(hourlyTable.reverse().slice(0, 24));

                    // BTC 시세 가져오기 및 사토시 통계 계산
                    const btcResponse = await fetch('https://api.upbit.com/v1/candles/minutes/60?market=KRW-BTC&count=24');
                    if (btcResponse.ok) {
                        const btcCandles = await btcResponse.json();
                        calculateSatoshiStats(allCandles, btcCandles);
                    }

                    await fetchStats(allCandles);

                } catch (error) {
                    console.error('Error:', error);
                }
            };

            const calculateSatoshiStats = (ethsolCandles, btcCandles) => {
                try {
                    const satoshiDiffs = [];
                    const minLen = Math.min(ethsolCandles['KRW-ETH'].length, ethsolCandles['KRW-SOL'].length, btcCandles.length, 24);

                    for (let i = 0; i < minLen; i++) {
                        const eth = ethsolCandles['KRW-ETH'][i];
                        const sol = ethsolCandles['KRW-SOL'][i];
                        const btc = btcCandles[i];

                        const ethSatoshi = (eth.trade_price / btc.trade_price) * 100000000 * ETH_AMOUNT;
                        const solSatoshi = (sol.trade_price / btc.trade_price) * 100000000 * SOL_AMOUNT;
                        const diff = ethSatoshi - solSatoshi;

                        satoshiDiffs.push({
                            diff,
                            timestamp: new Date(eth.candle_date_time_kst).getTime()
                        });
                    }

                    if (satoshiDiffs.length > 0) {
                        const sorted = [...satoshiDiffs].sort((a, b) => a.diff - b.diff);
                        setSatoshiStats({
                            max: sorted[sorted.length - 1],
                            min: sorted[0]
                        });
                    }
                } catch (error) {
                    console.error('Satoshi stats error:', error);
                }
            };

            const fetchStats = async (hourlyData) => {
                try {
                    const allMinutes = { 'KRW-ETH': [], 'KRW-SOL': [], 'KRW-BTC': [] };

                    // 1분봉 데이터 수집 (24시간용)
                    for (const market of ['KRW-ETH', 'KRW-SOL', 'KRW-BTC']) {
                        for (let i = 0; i < 8; i++) {
                            const to = new Date(Date.now() - (i * 200 * 60 * 1000)).toISOString();
                            const response = await fetch(`https://api.upbit.com/v1/candles/minutes/1?market=${market}&to=${to}&count=200`);
                            if (response.ok) {
                                const data = await response.json();
                                allMinutes[market].push(...data);
                                await new Promise(r => setTimeout(r, 100));
                            }
                        }
                    }

                    // 1시간봉 BTC 데이터 수집 (7일용)
                    const btcHourlyResponse = await fetch('https://api.upbit.com/v1/candles/minutes/60?market=KRW-BTC&count=168');
                    const btcHourlyCandles = btcHourlyResponse.ok ? await btcHourlyResponse.json() : [];

                    const calcSatoshi = (ethCandles, solCandles, btcCandles, timeLimit) => {
                        const now = Date.now();
                        const filtered = ethCandles.map((eth, idx) => {
                            const sol = solCandles[idx];
                            const btc = btcCandles[idx];
                            if (!sol || !btc) return null;
                            const ts = new Date(eth.candle_date_time_kst).getTime();
                            if (ts < now - timeLimit) return null;

                            const ethSatoshi = (eth.trade_price / btc.trade_price) * 100000000 * ETH_AMOUNT;
                            const solSatoshi = (sol.trade_price / btc.trade_price) * 100000000 * SOL_AMOUNT;

                            return {
                                diff: ethSatoshi - solSatoshi,
                                timestamp: ts
                            };
                        }).filter(Boolean);

                        if (!filtered.length) return null;
                        const sorted = [...filtered].sort((a, b) => a.diff - b.diff);
                        return { min: sorted[0], max: sorted[sorted.length - 1] };
                    };

                    setStats24h(calcSatoshi(allMinutes['KRW-ETH'], allMinutes['KRW-SOL'], allMinutes['KRW-BTC'], 24 * 60 * 60 * 1000));
                    setStats7d(calcSatoshi(hourlyData['KRW-ETH'], hourlyData['KRW-SOL'], btcHourlyCandles, 7 * 24 * 60 * 60 * 1000));

                } catch (error) {
                    console.error('Stats error:', error);
                }
            };

            const fetchDayChanges = async () => {
                try {
                    const response = await fetch('https://api.upbit.com/v1/ticker?markets=KRW-ETH,KRW-SOL,KRW-BTC');
                    const data = await response.json();
                    const changes = {};
                    data.forEach(item => {
                        const symbol = item.market.replace('KRW-', '').toLowerCase();
                        changes[symbol] = item.signed_change_rate * 100;
                    });
                    setDayChanges(changes);
                } catch (error) {
                    console.error('Error:', error);
                }
            };

            useEffect(() => {
                fetchDayChanges();
                fetchHourlyCandles();

                const ws = new WebSocket('wss://api.upbit.com/websocket/v1');
                wsRef.current = ws;

                ws.onopen = () => {
                    ws.send(JSON.stringify([
                        { ticket: 'tracker' },
                        { type: 'ticker', codes: ['KRW-ETH', 'KRW-SOL', 'KRW-BTC'] }
                    ]));
                    setLoading(false);
                };

                ws.onmessage = async (event) => {
                    const text = await event.data.text();
                    const data = JSON.parse(text);

                    if (data.type === 'ticker') {
                        const symbol = data.code.replace('KRW-', '').toLowerCase();
                        const price = data.trade_price;

                        setPrices(prev => {
                            const newPrices = { ...prev, [symbol]: price };

                            if (prevPricesRef.current[symbol]) {
                                const dir = price > prevPricesRef.current[symbol] ? 'up' : 'down';
                                triggerFlash(symbol, dir);

                                if (symbol === 'eth' || symbol === 'sol') {
                                    const oldDiff = (prevPricesRef.current.eth || 0) * ETH_AMOUNT - (prevPricesRef.current.sol || 0) * SOL_AMOUNT;
                                    const newDiff = (newPrices.eth || 0) * ETH_AMOUNT - (newPrices.sol || 0) * SOL_AMOUNT;
                                    if (oldDiff !== newDiff) {
                                        triggerFlash('difference', newDiff > oldDiff ? 'up' : 'down');
                                    }
                                }
                            }

                            prevPricesRef.current = newPrices;
                            return newPrices;
                        });
                    }
                };

                const int1 = setInterval(fetchHourlyCandles, 10 * 60 * 1000);
                const int2 = setInterval(fetchDayChanges, 60 * 1000);

                return () => {
                    ws.close();
                    clearInterval(int1);
                    clearInterval(int2);
                };
            }, []);

            if (loading || !prices.eth || !prices.sol || !prices.btc) {
                return <div className="loading">데이터 로딩중...</div>;
            }

            const fmt = (num) => Math.round(num).toLocaleString('ko-KR');
            const fmtTime = (ts) => {
                const d = new Date(ts);
                return `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
            };

            const ethTotal = prices.eth * ETH_AMOUNT;
            const solTotal = prices.sol * SOL_AMOUNT;
            const diff = ethTotal - solTotal;
            const totalFee = solTotal * FEE_RATE * 2;

            // 커스텀 ETH 수량에 대한 가격차이 계산
            const customDiff = customEthAmount ? (prices.eth * parseFloat(customEthAmount)) - solTotal : 0;

            // SOL 400개로 구매 가능한 ETH 계산 (수수료 포함)
            const solSellAmount = solTotal * (1 - FEE_RATE); // SOL 매도 후 금액
            const purchasableEth = (solSellAmount / prices.eth) * (1 - FEE_RATE); // ETH 구매 가능 수량
            const ethDiffAmount = purchasableEth - ETH_AMOUNT; // ETH 20개 대비 차이
            const ethDiffPercent = (ethDiffAmount / ETH_AMOUNT) * 100; // 퍼센트

            // 사토시 가격 계산 (1 BTC = 100,000,000 사토시)
            const ethSatoshi = (prices.eth / prices.btc) * 100000000 * ETH_AMOUNT;
            const solSatoshi = (prices.sol / prices.btc) * 100000000 * SOL_AMOUNT;
            const satoshiDiff = ethSatoshi - solSatoshi;

            return (
                <div className="container">
                    <div className="header">
                        <h1>솔라나-이더리움 가격 추적기</h1>
                        <div className="subtitle">ETH 20개 vs SOL 400개 + BTC</div>
                    </div>

                    <div className="main-grid">
                        <div className="card">
                            <div className="card-title">실시간 가격</div>
                            <div className="coin-grid">
                                <div className="coin-item">
                                    <div className="coin-name">BTC</div>
                                    <div className={`coin-price ${flashStates.btc ? `flash-${flashStates.btc}` : ''}`}>
                                        ₩{fmt(prices.btc)}
                                    </div>
                                    <div className={`coin-change ${dayChanges.btc >= 0 ? 'change-positive' : 'change-negative'}`}>
                                        {dayChanges.btc >= 0 ? '+' : ''}{dayChanges.btc.toFixed(2)}%
                                    </div>
                                </div>
                                <div className="coin-item">
                                    <div className="coin-name">ETH</div>
                                    <div className={`coin-price ${flashStates.eth ? `flash-${flashStates.eth}` : ''}`}>
                                        ₩{fmt(prices.eth)}
                                    </div>
                                    <div style={{display: 'flex', gap: '0.5rem', alignItems: 'center'}}>
                                        <div className={`coin-change ${dayChanges.eth >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {dayChanges.eth >= 0 ? '+' : ''}{dayChanges.eth.toFixed(2)}%
                                        </div>
                                        <div style={{fontSize: '0.6rem', color: 'var(--text-secondary)'}}>
                                            {((prices.eth / prices.btc) * 100).toFixed(4)}% BTC
                                        </div>
                                    </div>
                                </div>
                                <div className="coin-item">
                                    <div className="coin-name">SOL</div>
                                    <div className={`coin-price ${flashStates.sol ? `flash-${flashStates.sol}` : ''}`}>
                                        ₩{fmt(prices.sol)}
                                    </div>
                                    <div style={{display: 'flex', gap: '0.5rem', alignItems: 'center'}}>
                                        <div className={`coin-change ${dayChanges.sol >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {dayChanges.sol >= 0 ? '+' : ''}{dayChanges.sol.toFixed(2)}%
                                        </div>
                                        <div style={{fontSize: '0.6rem', color: 'var(--text-secondary)'}}>
                                            {((prices.sol / prices.btc) * 100).toFixed(4)}% BTC
                                        </div>
                                    </div>
                                </div>
                                <div className="coin-item" style={{background: 'linear-gradient(135deg, rgba(153, 69, 255, 0.1) 0%, rgba(0, 212, 255, 0.1) 100%)', border: '1px solid #9945ff', marginTop: '0.5rem'}}>
                                    <div className="coin-name" style={{color: '#9945ff', fontWeight: '700'}}>ETH 20개 - SOL 400개</div>
                                    <div className={`coin-price ${flashStates.difference ? `flash-${flashStates.difference}` : ''} ${diff >= 0 ? 'change-positive' : 'change-negative'}`} style={{fontSize: '0.9rem'}}>
                                        {diff >= 0 ? '+' : ''}₩{fmt(diff)}
                                    </div>
                                    <div className={`coin-change ${satoshiDiff >= 0 ? 'change-positive' : 'change-negative'}`} style={{fontSize: '0.6rem'}}>
                                        {satoshiDiff >= 0 ? '+' : ''}{Math.round(satoshiDiff).toLocaleString()} sats
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="card stats-card">
                            <div className="card-title">사토시 가격 비교</div>
                            <div className="stat-period">현재 가격</div>
                            <div className="stat-row">
                                <span className="stat-value" style={{fontSize: '0.75rem'}}>
                                    ETH 20개: {Math.round(ethSatoshi).toLocaleString()} sats
                                </span>
                            </div>
                            <div className="stat-row">
                                <span className="stat-value" style={{fontSize: '0.75rem'}}>
                                    SOL 400개: {Math.round(solSatoshi).toLocaleString()} sats
                                </span>
                            </div>
                            <div className="stat-row" style={{marginTop: '0.5rem'}}>
                                <span className={`stat-value ${satoshiDiff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                    차이: {satoshiDiff >= 0 ? '+' : ''}{Math.round(satoshiDiff).toLocaleString()} sats
                                </span>
                            </div>

                            {satoshiStats.max && satoshiStats.min && (
                                <>
                                    <div className="stat-period" style={{marginTop: '0.5rem'}}>24시간 최대 차이</div>
                                    <div className="stat-row">
                                        <span className={`stat-value ${satoshiStats.max.diff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {satoshiStats.max.diff >= 0 ? '+' : ''}{Math.round(satoshiStats.max.diff).toLocaleString()} sats
                                        </span>
                                        <span className="stat-time">{fmtTime(satoshiStats.max.timestamp)}</span>
                                    </div>

                                    <div className="stat-period" style={{marginTop: '0.3rem'}}>24시간 최소 차이</div>
                                    <div className="stat-row">
                                        <span className={`stat-value ${satoshiStats.min.diff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {satoshiStats.min.diff >= 0 ? '+' : ''}{Math.round(satoshiStats.min.diff).toLocaleString()} sats
                                        </span>
                                        <span className="stat-time">{fmtTime(satoshiStats.min.timestamp)}</span>
                                    </div>
                                </>
                            )}
                        </div>

                        <div className="card" style={{background: 'linear-gradient(135deg, #1a1a25 0%, #25252f 100%)', border: '2px solid #00d4ff'}}>
                            <div className="card-title">SOL 400개로 구매 가능한 ETH</div>
                            <div className="fee-grid">
                                <div className="fee-item">
                                    <span className="fee-label">SOL 400개 가치</span>
                                    <span className="fee-value">₩{fmt(solTotal)}</span>
                                </div>
                                <div className="fee-item">
                                    <span className="fee-label">매도 후 금액 (수수료 0.05%)</span>
                                    <span className="fee-value">₩{fmt(solTotal * (1 - FEE_RATE))}</span>
                                </div>
                                <div className="fee-item" style={{background: 'rgba(0, 212, 255, 0.1)', borderLeft: '3px solid var(--accent-blue)'}}>
                                    <span className="fee-label">구매 가능 ETH (수수료 포함)</span>
                                    <span className="fee-value" style={{fontSize: '0.9rem', color: 'var(--accent-blue)'}}>
                                        {purchasableEth.toFixed(8)} ETH
                                    </span>
                                </div>
                                <div className="fee-item">
                                    <span className="fee-label">ETH 20개 대비</span>
                                    <span className={`fee-value ${ethDiffPercent >= 0 ? 'change-positive' : 'change-negative'}`}>
                                        {ethDiffPercent >= 0 ? '+' : ''}{ethDiffPercent.toFixed(2)}% ({ethDiffAmount >= 0 ? '+' : ''}{ethDiffAmount.toFixed(4)} ETH)
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div className="card input-card">
                            <div className="card-title">커스텀 가격 차이</div>
                            <div className="input-label">ETH 수량 입력 (소수점 8자리)</div>
                            <input
                                type="number"
                                className="eth-input"
                                placeholder="0.00000000"
                                step="0.00000001"
                                min="0"
                                value={customEthAmount}
                                onChange={(e) => setCustomEthAmount(e.target.value)}
                            />
                            {customEthAmount && (
                                <>
                                    <div className={`diff-value ${customDiff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                        {customDiff >= 0 ? '+' : ''}₩{fmt(customDiff)}
                                    </div>
                                    <div className="diff-label">ETH {parseFloat(customEthAmount).toFixed(8)}개 - SOL 400개</div>
                                </>
                            )}
                        </div>

                        <div className="card">
                            <div className="card-title">포지션 정보</div>
                            <div className="fee-grid">
                                <div className="fee-item">
                                    <span className="fee-label">ETH 20개</span>
                                    <span className="fee-value">₩{fmt(ethTotal)}</span>
                                </div>
                                <div className="fee-item">
                                    <span className="fee-label">SOL 400개</span>
                                    <span className="fee-value">₩{fmt(solTotal)}</span>
                                </div>
                                <div className="fee-item">
                                    <span className="fee-label">24h 변동폭</span>
                                    <span className="fee-value">
                                        ₩{fmt(stats24h ? Math.abs(stats24h.max.diff - stats24h.min.diff) : 0)}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div className="card stats-card">
                            <div className="card-title">24시간 통계</div>
                            {stats24h ? (
                                <>
                                    <div className="stat-period">최대 차이</div>
                                    <div className="stat-row">
                                        <span className={`stat-value ${stats24h.max.diff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {stats24h.max.diff >= 0 ? '+' : ''}{Math.round(stats24h.max.diff).toLocaleString()} sats
                                        </span>
                                        <span className="stat-time">{fmtTime(stats24h.max.timestamp)}</span>
                                    </div>
                                    <div className="stat-period" style={{marginTop: '0.3rem'}}>최소 차이</div>
                                    <div className="stat-row">
                                        <span className={`stat-value ${stats24h.min.diff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {stats24h.min.diff >= 0 ? '+' : ''}{Math.round(stats24h.min.diff).toLocaleString()} sats
                                        </span>
                                        <span className="stat-time">{fmtTime(stats24h.min.timestamp)}</span>
                                    </div>
                                </>
                            ) : <div style={{color: 'var(--text-secondary)', fontSize: '0.7rem'}}>로딩중...</div>}
                        </div>

                        <div className="card stats-card">
                            <div className="card-title">7일 통계</div>
                            {stats7d ? (
                                <>
                                    <div className="stat-period">최대 차이</div>
                                    <div className="stat-row">
                                        <span className={`stat-value ${stats7d.max.diff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {stats7d.max.diff >= 0 ? '+' : ''}{Math.round(stats7d.max.diff).toLocaleString()} sats
                                        </span>
                                        <span className="stat-time">{fmtTime(stats7d.max.timestamp)}</span>
                                    </div>
                                    <div className="stat-period" style={{marginTop: '0.3rem'}}>최소 차이</div>
                                    <div className="stat-row">
                                        <span className={`stat-value ${stats7d.min.diff >= 0 ? 'change-positive' : 'change-negative'}`}>
                                            {stats7d.min.diff >= 0 ? '+' : ''}{Math.round(stats7d.min.diff).toLocaleString()} sats
                                        </span>
                                        <span className="stat-time">{fmtTime(stats7d.min.timestamp)}</span>
                                    </div>
                                </>
                            ) : <div style={{color: 'var(--text-secondary)', fontSize: '0.7rem'}}>로딩중...</div>}
                        </div>

                        <div className="card chart-card">
                            <div className="card-title">7일 사토시 가격차이 변동 (1시간봉)</div>
                            <div className="chart-info">
                                {hoverData ? (
                                    <>
                                        <div className="chart-info-item">
                                            <span className="chart-info-label">시간:</span>
                                            <span className="chart-info-value">
                                                {new Date(hoverData.x).toLocaleString('ko-KR', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })}
                                            </span>
                                        </div>
                                        <div className="chart-info-item">
                                            <span className="chart-info-label">시가:</span>
                                            <span className="chart-info-value">{Math.round(hoverData.o).toLocaleString()} sats</span>
                                        </div>
                                        <div className="chart-info-item">
                                            <span className="chart-info-label">종가:</span>
                                            <span className="chart-info-value">{Math.round(hoverData.c).toLocaleString()} sats</span>
                                        </div>
                                    </>
                                ) : (
                                    <span className="chart-info-placeholder">차트에 마우스를 올려 상세 정보 확인</span>
                                )}
                            </div>
                            <div className="chart-container">
                                {chartData.length > 0 ? (
                                    <CandlestickChart data={chartData} onHover={setHoverData} />
                                ) : (
                                    <div style={{padding: '1rem', color: 'var(--text-secondary)', fontSize: '0.7rem'}}>차트 로딩중...</div>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="status">
                        <div className="status-dot"></div>
                        <span>실시간 WebSocket</span>
                        <span>•</span>
                        <span>{chartData.length}개 봉</span>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
